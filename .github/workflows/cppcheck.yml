name: Cppcheck

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  cppcheck:
    name: Static Analysis
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Install cppcheck
      run: sudo apt-get update && sudo apt-get install -y cppcheck
    
    - name: Run cppcheck
      run: |
        cppcheck --enable=all \
          --suppress=missingIncludeSystem \
          --suppress=unusedFunction \
          --suppress=unmatchedSuppression \
          --error-exitcode=1 \
          --xml --xml-version=2 \
          include/ src/ examples/ 2> cppcheck-report.xml || true
    
    - name: Upload results
      uses: actions/upload-artifact@v5
      if: always()
      with:
        name: cppcheck-report
        path: cppcheck-report.xml

